<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test jQuery Conflict Fix</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .status { padding: 15px; margin: 10px 0; border-radius: 5px; }
        .success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .info { background: #d1ecf1; color: #0c5460; border: 1px solid #bee5eb; }
        #console-output { 
            background: #1e1e1e; 
            color: #d4d4d4; 
            padding: 15px; 
            border-radius: 5px; 
            font-family: monospace;
            max-height: 400px;
            overflow-y: auto;
            margin: 10px 0;
        }
        .log { color: #4ec9b0; }
        .warn { color: #dcdcaa; }
        .error-log { color: #f48771; }
    </style>
</head>
<body>
    <h1>üß™ Test jQuery Conflict Fix</h1>
    
    <div class="status info">
        <strong>Test Setup:</strong> jQuery je naƒçten√Ω p≈ôed na≈°√≠m scriptem
    </div>

    <div id="test-results"></div>

    <div>
        <h3>Console Output:</h3>
        <div id="console-output"></div>
    </div>

    <div style="margin-top: 20px;">
        <h3>Test Elements:</h3>
        <div id="delivery-treshold">Threshold Test</div>
        <div id="delivery-speed">Speed Test</div>
        <div id="delivery-date">Date Test</div>
        <div id="user-menu">User Menu</div>
        <div id="cart-toggle">Cart</div>
        <div id="buy-button-set-complete">Product</div>
    </div>

    <!-- Load jQuery FIRST (simulating real environment) -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    <script>
        // Verify jQuery is loaded
        const output = document.getElementById('console-output');
        const results = document.getElementById('test-results');
        
        output.innerHTML += `<div class="log">jQuery loaded: ${typeof jQuery !== 'undefined' ? '‚úì' : '‚úó'}</div>`;
        output.innerHTML += `<div class="log">jQuery version: ${jQuery ? jQuery.fn.jquery : 'N/A'}</div>`;
        output.innerHTML += `<div class="log">$ is jQuery: ${$ === jQuery ? '‚úì' : '‚úó'}</div>`;

        // Override console to capture errors
        const originalLog = console.log;
        const originalWarn = console.warn;
        const originalError = console.error;
        let errorCount = 0;

        console.log = function(...args) {
            originalLog.apply(console, args);
            output.innerHTML += `<div class="log">LOG: ${args.join(' ')}</div>`;
        };

        console.warn = function(...args) {
            originalWarn.apply(console, args);
            output.innerHTML += `<div class="warn">WARN: ${args.join(' ')}</div>`;
        };

        console.error = function(...args) {
            originalError.apply(console, args);
            output.innerHTML += `<div class="error-log">ERROR: ${args.join(' ')}</div>`;
            errorCount++;
        };

        // Set development mode
        globalThis.process = { env: { NODE_ENV: 'development' } };
        
        console.log('=== Starting buy button script ===');
    </script>

    <!-- Load our refactored script -->
    <script src="buybutton.js"></script>

    <script>
        // Test results after script loads
        setTimeout(() => {
            console.log('=== Test Results ===');
            console.log(`Errors detected: ${errorCount}`);
            console.log(`jQuery still available: ${$ === jQuery ? '‚úì' : '‚úó'}`);
            console.log(`$ function type: ${typeof $}`);
            
            // Test jQuery still works
            try {
                $('body').addClass('test-class');
                console.log('jQuery .addClass() works: ‚úì');
            } catch (e) {
                console.error('jQuery .addClass() failed: ‚úó', e.message);
            }

            // Display results
            if (errorCount === 0 && $ === jQuery) {
                results.innerHTML = `
                    <div class="status success">
                        <strong>‚úÖ Test PASSED!</strong><br>
                        - No jQuery conflicts detected<br>
                        - jQuery functionality preserved<br>
                        - Buy button script loaded successfully<br>
                        - IIFE isolation working correctly
                    </div>
                `;
            } else {
                results.innerHTML = `
                    <div class="status error">
                        <strong>‚ùå Test FAILED!</strong><br>
                        - Errors detected: ${errorCount}<br>
                        - jQuery preserved: ${$ === jQuery ? 'Yes' : 'No'}<br>
                        - Check console output above for details
                    </div>
                `;
            }

            // Check if delivery elements were updated
            const threshold = document.getElementById('delivery-treshold');
            const speed = document.getElementById('delivery-speed');
            
            if (threshold && threshold.textContent !== 'Threshold Test') {
                console.log('‚úì Delivery threshold updated:', threshold.textContent);
            }
            if (speed && speed.textContent !== 'Speed Test') {
                console.log('‚úì Delivery speed updated:', speed.textContent);
            }
        }, 2000);
    </script>
</body>
</html>
